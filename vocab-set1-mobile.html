<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>ç¬¬ä¸€çµ„è©å½™ï¼ˆæ‰‹æ©Ÿç‰ˆï¼‰</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  * { box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
  body {
    margin: 0;
    padding: 16px;
    background: #f5f5f5;
    display: flex;
    justify-content: center;
    /* é¿å… iOS é»æ“Šé«˜äº® */
    -webkit-tap-highlight-color: transparent;
    min-height: 100vh;
  }

  .app {
    width: 100%;
    max-width: 520px;
    background: #fff;
    border-radius: 16px;
    box-shadow: 0 5px 16px rgba(0,0,0,0.1);
    padding: 20px;
    display: flex;
    flex-direction: column;
  }

  h1 { text-align: center; margin-bottom: 8px; }
  .subtitle { text-align: center; font-size: 13px; color: #666; margin-bottom: 12px; }
  .ios-hint { 
    text-align: center; 
    font-size: 12px; 
    color: #e74c3c; 
    margin-bottom: 10px; 
    display: none; 
  }

  /* èªé€ŸæŒ‰éˆ• */
  .speed-controls {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin-bottom: 15px;
  }
  .speed-btn {
    padding: 6px 14px;
    font-size: 14px;
    border-radius: 20px;
    border: none;
    background: #eee;
    cursor: pointer;
  }
  .speed-btn.active {
    background: #ffd86b;
    color: #543a00;
    font-weight: 600;
  }

  /* å¡ç‰‡å®¹å™¨ */
  .card {
    width: 100%;
    perspective: 1000px;
    cursor: pointer;
    position: relative;
    /* ä¿®æ”¹é»ï¼šåŠ å…¥é«˜åº¦éæ¸¡å‹•ç•«ï¼Œç§»é™¤å›ºå®šçš„ margin-bottom */
    transition: height 0.3s ease; 
    margin-bottom: 20px; /* èˆ‡ä¸‹æ–¹æŒ‰éˆ•ä¿æŒåŸºæœ¬è·é›¢ */
  }

  /* ç§»é™¤åŸæœ¬çš„ .card-expanded margin è¨­å®šï¼Œæ”¹ç”± JS æ§åˆ¶é«˜åº¦ */

  .card-inner {
    width: 100%;
    position: relative;
    transition: transform .6s;
    transform-style: preserve-3d;
  }
  .card.flipped .card-inner { transform: rotateY(180deg); }

  .card-face {
    position: absolute;
    width: 100%;
    min-height: 240px;
    padding: 20px;
    border-radius: 14px;
    border: 1px solid #ddd;
    background: #fafafa;
    backface-visibility: hidden;
    -webkit-backface-visibility: hidden;
    top: 0;
    left: 0;
  }
  
  .card-front { 
    display: flex; 
    justify-content: center; 
    align-items: center; 
    flex-direction: column;
    z-index: 2; /* ç¢ºä¿æ­£é¢åœ¨æœªç¿»è½‰æ™‚åœ¨ä¸Šæ–¹ */
  }
  .card-back { 
    transform: rotateY(180deg); 
    z-index: 1;
  }

  .jp-word-front {
    font-size: 48px;
    margin-bottom: 6px;
    border-bottom: 2px dashed #ddd; 
  }
  .front-hint {
    font-size: 13px;
    color: #777;
  }

  /* æ”¶è—æ˜Ÿæ˜Ÿ */
  .fav-icon {
    position: absolute;
    top: 8px;
    right: 12px;
    font-size: 26px;
    cursor: pointer;
    z-index: 10;
    padding: 10px;
  }

  /* table */
  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 15px;
  }
  th {
    text-align: left;
    width: 85px; /*ç¨å¾®ç¸®å°æ¨™é¡Œæ¬„å¯¬åº¦ä»¥é©æ‡‰æ‰‹æ©Ÿ*/
    color: #888;
    padding: 8px 4px;
    vertical-align: top;
    border-bottom: 1px solid #eee;
  }
  td {
    color: #222;
    padding: 8px 4px;
    border-bottom: 1px solid #eee;
    line-height: 1.5;
  }
  tr:last-child th, tr:last-child td {
    border-bottom: none;
  }

  .audio-btn {
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    margin-left: 6px;
    vertical-align: middle;
    padding: 0;
  }

  /* æŒ‰éˆ•å€å¡Š */
  .controls {
    display: flex;
    justify-content: space-between;
    gap: 15px;
    /* ä¿®æ”¹é»ï¼šå¢åŠ ä¸Šæ–¹é–“è·ï¼Œé¿å…è²¼è‘—å¡ç‰‡ */
    margin-top: 20px; 
    padding-top: 10px;
    border-top: 1px solid #f0f0f0;
  }
  button.nav {
    flex: 1;
    padding: 14px 0;
    font-size: 16px;
    border-radius: 12px;
    border: none;
    background: #f0f0f0;
    color: #333;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.2s;
  }
  button.nav:active { background: #e0e0e0; transform: scale(0.98); }
  button.nav:disabled { opacity: 0.4; cursor: not-allowed; }

  .index {
    text-align: center;
    margin-top: 15px;
    color: #999;
    font-size: 14px;
  }
</style>
</head>

<body>
<div class="app">

<h1>ç¬¬ä¸€çµ„è©å½™ï¼ˆæ‰‹æ©Ÿç‰ˆï¼‰</h1>
<div class="subtitle">é»æ“Šå¡ç‰‡åè½‰ï½œé»å­—æˆ–ğŸ”Šæ’­æ”¾èªéŸ³</div>
<div class="ios-hint" id="iosHint">âš ï¸ iPhone ç”¨æˆ¶è«‹æ³¨æ„ï¼šè«‹è§£é™¤ã€ŒéœéŸ³æ¨¡å¼ã€(æ’¥é–‹å´é‚Šé–‹é—œ)ï¼Œå¦å‰‡æœƒæ²’æœ‰è²éŸ³ã€‚</div>

<div class="speed-controls">
  <button class="speed-btn" data-rate="0.6">ğŸŒ è¶…æ…¢</button>
  <button class="speed-btn" data-rate="0.8">ğŸ¢ æ…¢</button>
  <button class="speed-btn active" data-rate="1.0">ğŸ˜€ æ™®é€š</button>
</div>

<!-- å¡ç‰‡å®¹å™¨ -->
<div class="card" id="card">
  <div class="fav-icon" id="favIcon">â˜†</div>

  <div class="card-inner">

    <!-- æ­£é¢ -->
    <div class="card-face card-front">
      <div class="jp-word-front" id="jpWordFront"></div>
      <div class="front-hint">ï¼ˆé»å­—æ’­æ”¾è®€éŸ³ï¼‰</div>
    </div>

    <!-- èƒŒé¢ -->
    <div class="card-face card-back">
      <table>
        <tr><th>è©æ€§</th><td id="posBack"></td></tr>
        <tr><th>ç¾…é¦¬éŸ³</th><td id="romajiBack"></td></tr>
        <tr><th>ä¸­æ–‡</th><td id="cnBack"></td></tr>

        <tr>
          <th>æ¼¢å­—ä¾‹å¥</th>
          <td>
            <span id="exampleJpAlt"></span>
            <button class="audio-btn" id="audioSentenceAltBtn">ğŸ”Š</button>
          </td>
        </tr>

        <tr>
          <th>æ—¥æ–‡ä¾‹å¥</th>
          <td>
            <span id="exampleJpBack"></span>
            <button class="audio-btn" id="audioSentenceBtn">ğŸ”Š</button>
          </td>
        </tr>

        <tr><th>ä¸­æ–‡ä¾‹å¥</th><td id="exampleCnBack"></td></tr>
        <tr><th>èªæ³•</th><td id="grammarBack"></td></tr>
      </table>
    </div>
  </div>
</div>

<!-- æŒ‰éˆ•å€ -->
<div class="controls">
  <button class="nav" id="prevBtn">ä¸Šä¸€å€‹</button>
  <button class="nav" id="nextBtn">ä¸‹ä¸€å€‹</button>
</div>
<div class="index" id="indexInfo"></div>

<script>
/* --- Vocab Data --- */
const vocab = [
  {
    jp:"ã‚ãŸã—",
    romaji:"watashi",
    pos:"åè©ï½œä»£åè©",
    cn:"æˆ‘",
    exampleJp:"ã‚ãŸã—ã¯ ã‚Šã‚“ã”ãŒ ã™ãã§ã™ã€‚",
    exampleJpAlt:"ç§ã¯ãƒªãƒ³ã‚´ãŒå¥½ãã§ã™ã€‚",
    exampleCn:"æˆ‘å–œæ­¡è˜‹æœã€‚",
    grammar:"å¸¸é…ã€Œã¯ã€ç•¶ä¸»é¡Œã€‚"
  },
  {
    jp:"ã‚ãªãŸ",
    romaji:"anata",
    pos:"ä»£åè©",
    cn:"ä½ ",
    exampleJp:"ã‚ãªãŸã¯ ã©ã“ã‹ã‚‰ ãã¾ã—ãŸã‹ã€‚",
    exampleJpAlt:"ã‚ãªãŸã¯ã©ã“ã‹ã‚‰æ¥ã¾ã—ãŸã‹ã€‚",
    exampleCn:"ä½ å¾å“ªè£¡ä¾†ï¼Ÿ",
    grammar:"å¯¦éš›å°è©±å°‘ç›´æ¥è¬›ã€Œä½ ã€ã€‚"
  },
  {
    jp:"ã‚ã®ã²ã¨",
    romaji:"ano hito",
    pos:"åè©",
    cn:"é‚£å€‹äºº",
    exampleJp:"ã‚ã®ã²ã¨ã¯ ã‹ã„ã—ã‚ƒã„ã‚“ã§ã™ã€‚",
    exampleJpAlt:"ã‚ã®äººã¯ä¼šç¤¾å“¡ã§ã™ã€‚",
    exampleCn:"é‚£å€‹äººæ˜¯å…¬å¸è·å“¡ã€‚",
    grammar:"ç¦®è²Œèªï¼šã‚ã®ã‹ãŸã€‚"
  },
  {
    jp:"ã‹ã‚Œ",
    romaji:"kare",
    pos:"ä»£åè©",
    cn:"ä»–",
    exampleJp:"ã‹ã‚Œã¯ ãŒãã›ã„ã§ã™ã€‚",
    exampleJpAlt:"å½¼ã¯å­¦ç”Ÿã§ã™ã€‚",
    exampleCn:"ä»–æ˜¯å­¸ç”Ÿã€‚",
    grammar:"æœ‰æ™‚å¯æŒ‡ã€Œç”·æœ‹å‹ã€ã€‚"
  }
];

/* --- DOM --- */
const card = document.getElementById("card");
const favIcon = document.getElementById("favIcon");
const jpWordFront = document.getElementById("jpWordFront");
const posBack = document.getElementById("posBack");
const romajiBack = document.getElementById("romajiBack");
const cnBack = document.getElementById("cnBack");
const exampleJpBack = document.getElementById("exampleJpBack");
const exampleJpAlt = document.getElementById("exampleJpAlt");
const exampleCnBack = document.getElementById("exampleCnBack");
const grammarBack = document.getElementById("grammarBack");
const audioSentenceBtn = document.getElementById("audioSentenceBtn");
const audioSentenceAltBtn = document.getElementById("audioSentenceAltBtn");
const prevBtn = document.getElementById("prevBtn");
const nextBtn = document.getElementById("nextBtn");
const indexInfo = document.getElementById("indexInfo");
const iosHint = document.getElementById("iosHint");

let idx = 0;
let speechRate = 1.0;
let hardSet = new Set();
let voices = [];

/* --- Detect iOS for hint --- */
function isIOS() {
  return [
    'iPad Simulator', 'iPhone Simulator', 'iPod Simulator', 'iPad', 'iPhone', 'iPod'
  ].includes(navigator.platform) || (navigator.userAgent.includes("Mac") && "ontouchend" in document);
}
if (isIOS()) {
  iosHint.style.display = "block";
}

/* --- Speech Function --- */
function loadVoices() {
  voices = window.speechSynthesis.getVoices();
}
loadVoices();
if (window.speechSynthesis.onvoiceschanged !== undefined) {
  window.speechSynthesis.onvoiceschanged = loadVoices;
}

function speak(text){
  window.speechSynthesis.cancel();
  const u = new SpeechSynthesisUtterance(text);
  u.lang = "ja-JP";
  u.rate = speechRate;
  if (voices.length > 0) {
    const jaVoice = voices.find(v => v.lang === 'ja-JP') || voices.find(v => v.lang.includes('ja'));
    if (jaVoice) u.voice = jaVoice;
  }
  u.onerror = (e) => console.error("Speech error:", e);
  window.speechSynthesis.speak(u);
}

/* --- ä¿®æ”¹é»ï¼šå‹•æ…‹æ›´æ–°å¡ç‰‡é«˜åº¦ --- */
function updateCardHeight() {
  // å–å¾—æ­£é¢èˆ‡èƒŒé¢çš„DOMå…ƒç´ 
  const front = document.querySelector('.card-front');
  const back = document.querySelector('.card-back');
  
  // åˆ¤æ–·ç›®å‰æ˜¯å¦ç¿»è½‰
  const isFlipped = card.classList.contains('flipped');
  
  // å–å¾—ç›®æ¨™é¢çš„é«˜åº¦ (offsetHeight)
  let targetHeight = isFlipped ? back.offsetHeight : front.offsetHeight;
  
  // è¨­ç½®å¡ç‰‡å®¹å™¨çš„é«˜åº¦ (é€™æ¨£æŒ‰éˆ•å°±æœƒè‡ªå‹•è¢«æ¨ä¸‹å»)
  // è‹¥å–å¾—çš„é«˜åº¦ç‚º0(å¯èƒ½å› ç‚ºè¼‰å…¥å»¶é²)ï¼Œçµ¦ä¸€å€‹é è¨­å€¼ 240
  if(targetHeight < 240) targetHeight = 240;
  
  card.style.height = targetHeight + 'px';
}

/* --- Update Card Content --- */
function loadCard(){
  const v = vocab[idx];
  jpWordFront.textContent = v.jp;
  posBack.textContent = v.pos;
  romajiBack.textContent = v.romaji;
  cnBack.textContent = v.cn;
  exampleJpAlt.textContent = v.exampleJpAlt;
  exampleJpBack.textContent = v.exampleJp;
  exampleCnBack.textContent = v.exampleCn;
  grammarBack.textContent = v.grammar;

  indexInfo.textContent = `ç¬¬ ${idx+1} / ${vocab.length} å€‹`;

  prevBtn.disabled = idx === 0;
  nextBtn.disabled = idx === vocab.length - 1;

  favIcon.textContent = hardSet.has(v.jp) ? "â˜…" : "â˜†";
  
  // æ¯æ¬¡è¼‰å…¥æ–°å¡ç‰‡ï¼Œæ›´æ–°é«˜åº¦
  // ä½¿ç”¨ setTimeout ç¢ºä¿å…§å®¹æ¸²æŸ“å®Œç•¢å¾Œå†è¨ˆç®—é«˜åº¦
  setTimeout(updateCardHeight, 50);
}

/* --- Events --- */
jpWordFront.onclick = (e)=>{
  e.stopPropagation();
  speak(vocab[idx].jp);
};

audioSentenceBtn.onclick = e=>{
  e.stopPropagation();
  speak(vocab[idx].exampleJp);
};
audioSentenceAltBtn.onclick = e=>{
  e.stopPropagation();
  speak(vocab[idx].exampleJpAlt);
};

card.onclick = (e)=>{
  if (e.target === favIcon) return;
  
  card.classList.toggle("flipped");
  // ç§»é™¤ card-expanded é¡åˆ¥ï¼Œå› ç‚ºæˆ‘å€‘æ”¹ç”¨ height æ§åˆ¶
  // card.classList.toggle("card-expanded"); 
  
  // ç¿»è½‰æ™‚æ›´æ–°é«˜åº¦
  updateCardHeight();
};

prevBtn.onclick = ()=>{
  if(idx > 0){
    idx--;
    card.classList.remove("flipped");
    loadCard();
  }
};
nextBtn.onclick = ()=>{
  if(idx < vocab.length - 1){
    idx++;
    card.classList.remove("flipped");
    loadCard();
  }
};

document.querySelectorAll(".speed-btn").forEach(btn=>{
  btn.onclick = ()=>{
    document.querySelectorAll(".speed-btn").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    speechRate = Number(btn.dataset.rate);
  };
});

favIcon.onclick = e=>{
  e.stopPropagation();
  const word = vocab[idx].jp;
  hardSet.has(word) ? hardSet.delete(word) : hardSet.add(word);
  favIcon.textContent = hardSet.has(word) ? "â˜…" : "â˜†";
};

/* Init */
loadCard();

// ç›£è½è¦–çª—æ”¹è®Šå¤§å°ï¼Œç¢ºä¿é«˜åº¦æ­£ç¢º
window.addEventListener('resize', updateCardHeight);
</script>

</body>
</html>
